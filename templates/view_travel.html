
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <title>View travel</title>
    </head>

    <body>
        <h1>Logged travel</h1><br>
        <div id="filterForm">
            <h2>Filter Travels</h2>

            Start date<input type = "date" id = "start_date"><br>
            End date<input type = "date" id = "end_date"><br>
            City<input type = "text" id = "city"><br>
            Country<input type = "text" id = "country"><br>
        </div>>
            <button id="filterBtn">Apply Filters</button>
            <button id="clearBtn">Clear Filters</button>
        </div>
        
        <table border="1" style="margin-top:20px;">
            <thead>
            <tr>
                <th>City</th>
                <th>Country</th>
                <th>Start Date</th>
                <th>End Date</th>
            </tr>
            </thead>
            <tbody>
                {% for travel in travels %}
                <tr>
                    <td>{{ travel.location_city }}</td>
                    <td>{{ travel.location_country }}</td>
                    <td>{{ travel.start_date }}</td>
                    <td>{{ travel.end_date }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <script>
        async function loadTravels(filters = {}) {
        let url = new URL('/api/view-travel', window.location.origin);
        
        // Add filters to URL if any
        Object.keys(filters).forEach(key => url.searchParams.append(key, filters[key]));
        
        const response = await fetch(url);
        const travels = await response.json();
        
        const tableBody = document.getElementById('travelTableBody');
          tableBody.innerHTML = ''; // Clear table
        
        if (travels.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="4">No travels found</td></tr>';
            return;
        }
        
        travels.forEach(travel => {
            const row = `
            <tr>
                <td>${travel.city}</td>
                <td>${travel.country}</td>
                <td>${travel.start_date}</td>
                <td>${travel.end_date}</td>
            </tr>
            `;
            tableBody.innerHTML += row;
        });
        }
        
        document.getElementById('filterBtn').addEventListener('click', () => {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const location = document.getElementById('location').value;
        
        const filters = {};
        if (startDate) filters.start_date = startDate;
        if (endDate) filters.end_date = endDate;
        if (location) filters.location = location;
        
        loadTravels(filters);
        });
        
        document.getElementById('clearBtn').addEventListener('click', () => {
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.getElementById('location').value = '';
        
        loadTravels();
        });
        
        // Load all travels on page load
        loadTravels();
        </script>
        
        </body>
        </html>